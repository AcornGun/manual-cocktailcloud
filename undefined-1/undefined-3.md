# 볼륨과 영구 볼륨 사용

볼륨은 간단히 말해서 디스크 내지 컨테이너 상에 존재하는 디렉토리 정도로 생각할 수 있습니다. 기본적으로 볼륨의 수명은 그를 감싸고 있는 Pod와 동일합니다. Pod가 존재하길 그치면, 볼륨도 함께 사라집니다.

하지만, 어떤 경우에는 Pod가 사라지더라도 디스크 상의 데이터를 유지해야 할 수 있습니다. 이 경우에는 영구 볼륨을 사용합니다.

## 어떤 볼륨 유형을 제공하는가?

* 일반 볼륨: emptyDir과 hostPath 방식을 지원합니다.
* 영구 볼륨: 하나의 노드에서만 사용할 수 있는 Single 유형과 여러 노드 상에서 공유할 수 있는 Shared 유형을 지원합니다.

## 영구 볼륨 관리의 특장점은 무엇인가요?

### PV와 PVC 자동 생성

사용자가 필요로 하는 영구 볼륨의 최소 필수 요건을 입력하면 칵테일 클라우드가 내부적으로 자동적으로 관련 PV \(Persistent Volume\)과 PVC \(Persistent Volume Claim\) 리소스를 생성하고, 해당 PVC에 대한 PV를 매칭시켜줍니다.

### 볼륨 및 볼륨 마운트 구성의 용이성

개발자는 설정 중인 Pod에서 생성된 해당 PVC를 선택하여 볼륨 및 볼륨 마운트를 구성만 하면 됩니다.

## 태스크 목록

* 볼륨 요청 생성
* 볼륨 요청 조회
* 컨테이너에서의 볼륨 사용

## 1. 볼륨 요청 생성

서비스 맵의 볼륨 요청 화면에 접근하여 우측 상단의 "+생성" 버튼을 클릭합니다. 사용자가 원하는 스토리지 볼륨을 생성하면 내부적으로 볼륨 요청 \(PVC\)와 볼륨이 자동 생성됩니다.

![\[&#xD654;&#xBA74;\] &#xBCFC;&#xB968; &#xC694;&#xCCAD; &#xC0DD;&#xC131;](../.gitbook/assets/2020-10-15-9.47.15.png)

## 2. 볼륨 요청 조회

### 2.1 볼륨 요청 목록 조회

서비스 맵의 볼륨 요청 화면을 접근하면 사용자가 생성한 볼륨 요청 목록이 표시됩니다. 

![\[&#xD654;&#xBA74;\] &#xBCFC;&#xB968; &#xC694;&#xCCAD; &#xBAA9;&#xB85D; &#xC870;&#xD68C;](../.gitbook/assets/2020-10-15-9.48.16.png)

### 2.2 PVC 조회

생성된 볼륨 요청과 관련된 PVC의 상세 정보를 조회하기 위해서는 볼륨 요청 목록에서 이름 링크를 클릭합니다.

![\[&#xD654;&#xBA74;\] PVC &#xC0C1;&#xC138; &#xC815;&#xBCF4; &#xC870;&#xD68C;](../.gitbook/assets/2020-10-15-9.49.50.png)

생성된 PVC의 상세 정보를 YAML 형식으로 보기 위해서는 상단 화면에서 설정 버튼을 클릭한 후, 좌측 선택 박스에서 "YAML 보기"를 선택합니다.

![\[&#xD654;&#xBA74;\] PVC &#xC0C1;&#xC138; &#xC815;&#xBCF4; &#xBCF4;&#xAE30; \(YAML &#xD615;&#xC2DD; &#xC870;&#xD68C;\)](../.gitbook/assets/2020-10-15-9.55.08.png)

### 2.3 PV 조회

볼륨 요청 목록 화면에서 생성된 볼륨 요청과 관련된 PV 정보를 조회하기 위해서는 볼륨\(PV\) 이름 링크를 클릭합니다.

![\[&#xD654;&#xBA74;\] PV &#xC0C1;&#xC138; &#xC815;&#xBCF4; &#xC870;&#xD68C;](../.gitbook/assets/2020-10-15-10.49.17.png)

생성된 PV의 상세 정보를 YAML 형식으로 보기 위해서는 상단 화면에서 설정 버튼을 클릭한 후, 좌측 선택 박스에서 "YAML 보기"를 선택합니다.

![\[&#xD654;&#xBA74;\] PV &#xC0C1;&#xC138; &#xC815;&#xBCF4; &#xC870;&#xD68C; \(YAML &#xD615;&#xC2DD;\)](../.gitbook/assets/2020-10-15-11.24.41.png)

## 3. 컨테이너에서의 볼륨 사용

서비스 맵 화면에서 볼륨을 설정할 워크로드의 이름을 클릭하면, 워크로드의 상세 화면이 표시됩니다. 워크로드 관련 설정을 하기 위해서는 상단 우측의 "설정" 버튼을 클릭합니다. 워크로드 상세 설정 화면이 표시됩니다.

기존 동작 중인 워크로드에서 볼륨을 사용하려고 하거나 새로 정의하고 있는 워크로드에서 볼륨을 사용하려고 하거나 볼륨 및 볼륨 마운트 설정 방법은 동일합니다.

![\[&#xD654;&#xBA74;\] &#xC6CC;&#xD06C;&#xB85C;&#xB4DC; &#xC0C1;&#xC138; &#xC124;&#xC815; &#xD654;&#xBA74;](../.gitbook/assets/2020-10-15-11.43.09.png)

### 3.1 볼륨 추가

워크로드 상세 설정 화면의 하단 볼륨 섹션의 오른쪽 부분에 있는 "+ Add" 버튼를 클릭합니다. 

볼륨 유형을 선택하고, 볼륨 명을 입력합니다. 선택한 볼륨 유형에 따라 추가적인 입력 정보가 요구될 수 있습니다. 영구 볼륨일 경우에는 볼륨 요청을 입력해야 하는데, 미리 설정해 놓은 볼륨 요청 목록이 표시되어 간단하게 선택할 수 있습니다. 

![\[&#xD654;&#xBA74;\] &#xBCFC;&#xB968; &#xCD94;&#xAC00; &#xC2DC; &#xBCFC;&#xB968; &#xC720;&#xD615; &#xC120;&#xD0DD; &#xD654;&#xBA74;](../.gitbook/assets/2020-10-15-11.44.48.png)

![\[&#xD654;&#xBA74;\] &#xC601;&#xAD6C; &#xBCFC;&#xB968; &#xCD94;&#xAC00; &#xC2DC; &#xBCFC;&#xB968; &#xC694;&#xCCAD; &#xC120;&#xD0DD;](../.gitbook/assets/2020-10-15-11.45.45.png)

"적용" 버튼을 클릭하여 볼륨을 생성합니다.

### 3.2 볼륨 마운트 설정 

볼륨을 추가한 후 이를 워크로드에서 사용하기 위해서는 해당 볼륨을 디토리 구조로 마운트시켜야 합니다. 워크로드 상세 설정 화면의 하단 볼륨 마운트 섹션의 오른쪽 부분에 있는 "+" 기호를 클릭합니다. 

볼륨을 마운트시킬 컨테이너를 선택하고 볼륨을 선택한 후, "+ 추가" 버튼을 클릭합니다. 마운트 시킬 경로를 입력하도록 합니다.

![\[&#xD654;&#xBA74;\] &#xBCFC;&#xB968; &#xB9C8;&#xC6B4;&#xD2B8; &#xC815;&#xBCF4; &#xC785;&#xB825;](../.gitbook/assets/2020-10-15-1.50.42.png)

"적용" 버튼을 클릭하여 볼륨 마운트를 생성합니다.

### 3.3 워크로드 재시작

볼륨 추가 및 볼륨 마운트 설정을 수행한 후, 실제 효과를 발휘하기 위해서는 워크로드 상세 설정 화면 상단 우측의 "저장 후 시작" 버튼을 클릭합니다. 설정한 볼륨과 볼륨 요청이 적용되어해당 컨테이너가 재시작되는 것을 조회할 수 있습니다.

![\[&#xD654;&#xBA74;\] &#xBCFC;&#xB968; &#xCD94;&#xAC00; &#xBC0F; &#xBCFC;&#xB968; &#xC694;&#xCCAD; &#xC124;&#xC815; &#xD6C4; &#xC6CC;&#xD06C;&#xB85C;&#xB4DC; &#xC7AC;&#xC2DC;&#xB3D9; &#xD655;&#xC778;](../.gitbook/assets/2020-10-15-1.56.01.png)



